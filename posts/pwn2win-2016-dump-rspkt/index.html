<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta name=author content="xil.se"><link rel=prev href=https://blog.xil.se/posts/pwn2win-2016-painel-message-rspkt/><link rel=next href=https://blog.xil.se/posts/pwn2win-2016-secret-accounts-rspkt/><link rel=canonical href=https://blog.xil.se/posts/pwn2win-2016-dump-rspkt/><link rel=apple-touch-icon sizes=180x180 href=https://blog.xil.se/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://blog.xil.se/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://blog.xil.se/favicon-16x16.png><link rel=manifest href=https://blog.xil.se/site.webmanifest><link rel=mask-icon href=https://blog.xil.se/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><title>Pwn2Win CTF 2016 Dump (Forensics 50) Writeup | Blog</title><meta name=title content="Pwn2Win CTF 2016 Dump (Forensics 50) Writeup | Blog"><link rel=stylesheet href=https://blog.xil.se/font/iconfont.css><link rel=stylesheet href=https://blog.xil.se/css/main.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.xil.se\/"},"articleSection":"posts","name":"Pwn2Win CTF 2016 Dump (Forensics 50) Writeup","headline":"Pwn2Win CTF 2016 Dump (Forensics 50) Writeup","description":"Problem  Description: We know this dump was generated by a process which was executing as root in the computer, and that it was reading directly from a \/dev device. Probably it is part of a keylogger module included in a rootkit which is being tested by the Club. Help us to unveil this message, allowing us to discover why they infected this specific machine.\n Solution The dump file contained data that seemed to align well for 24 bytes, indicating that each record of the captured input was stored in some 24 byte datastructure.","inLanguage":"en-us","author":"rspkt","creator":"rspkt","publisher":"rspkt","accountablePerson":"rspkt","copyrightHolder":"rspkt","copyrightYear":"2016","datePublished":"2016-03-28 01:14:00 \u002b0100 \u002b0100","dateModified":"2016-03-28 01:14:00 \u002b0100 \u002b0100","url":"https:\/\/blog.xil.se\/posts\/pwn2win-2016-dump-rspkt\/","wordCount":"441","keywords":["Blog"]}</script></head><body><div class=wrapper><nav class=navbar><div class=container><div class="navbar-header header-logo"><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href=https://blog.xil.se/>Blog</a></div><div class="menu navbar-right"><a class=menu-item href=https://blog.xil.se/posts/>Blog</a>
<a class=menu-item href=https://blog.xil.se/categories/>Categories</a></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><div class=container><div class=navbar-header><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href=https://blog.xil.se/>Blog</a></div><div class=menu-toggle><span></span><span></span><span></span></div></div><div class=menu id=mobile-menu><a class=menu-item href=https://blog.xil.se/posts/>Blog</a>
<a class=menu-item href=https://blog.xil.se/categories/>Categories</a></div></div></nav><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">Pwn2Win CTF 2016 Dump (Forensics 50) Writeup</h1><div class=post-meta>Written by <a itemprop=name href=https://blog.xil.se/author/rspkt rel=author>rspkt</a> with â™¥
<span class=post-time>on <time datetime=2016-03-28 itemprop=datePublished>March 28, 2016</time></span>
in
<i class="iconfont icon-folder"></i><span class=post-category><a href=https://blog.xil.se/categories/writeups/>writeups</a></span></div></header><div class=post-content><h1 id=problem>Problem</h1><blockquote><p>Description: We know this dump was generated by a process which was executing
as root in the computer, and that it was reading directly from a /dev device.
Probably it is part of a keylogger module included in a rootkit which is being
tested by the Club. Help us to unveil this message, allowing us to discover why
they infected this specific machine.</p></blockquote><h1 id=solution>Solution</h1><p>The dump file contained data that seemed to align well for 24 bytes, indicating
that each record of the captured input was stored in some 24 byte
datastructure.</p><p>We loaded it into a small C program, and could quickly see that the
first 16 bytes were increasing throughout the dump.</p><pre><code>00000000568a8e79 00000000000a59d0 0007002800040004
00000000568a8e79 00000000000a59d0 00000000001c0001
00000000568a8e79 00000000000a59d0 0000000000000000
00000000568a8e7b 00000000000ab77f 000700e100040004
00000000568a8e7b 00000000000ab77f 00000001002a0001
00000000568a8e7b 00000000000ab77f 0000000000000000
00000000568a8e7b 00000000000c2e82 0007000c00040004
00000000568a8e7b 00000000000c2e82 0000000100170001
00000000568a8e7b 00000000000c2e82 0000000000000000
00000000568a8e7b 00000000000da586 0007000c00040004
00000000568a8e7b 00000000000da586 0000000000170001
00000000568a8e7b 00000000000da586 0000000000000000
00000000568a8e7b 00000000000de3f9 000700e100040004
00000000568a8e7b 00000000000de3f9 00000000002a0001
00000000568a8e7b 00000000000de3f9 0000000000000000
00000000568a8e7c 000000000000d438 0007002c00040004
00000000568a8e7c 000000000000d438 0000000100390001
00000000568a8e7c 000000000000d438 0000000000000000
00000000568a8e7c 00000000000289a7 0007002c00040004
00000000568a8e7c 00000000000289a7 0000000000390001
00000000568a8e7c 00000000000289a7 0000000000000000
00000000568a8e7c 00000000000325f9 0007000400040004
00000000568a8e7c 00000000000325f9 00000001001e0001
00000000568a8e7c 00000000000325f9 0000000000000000
</code></pre><p>Translating it to integer reveals that it&rsquo;s actually a timestamp, or more
precisely a timeval struct. The last eight bytes were much more interesting.
After Googling a bit, we found that the datastructure <code>input_event</code> defined in
<code>linux/input.h</code> is the one used by the Linux kernel to represent keyboard
events.</p><p>Unpacking the binary data into the struct gave us the message:
<strong>I am suspicious of Fideleetos intentions</strong></p><p>Code:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdint.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;sys/time.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;linux/input.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>typedef</span> <span style=color:#66d9ef>struct</span> {
	<span style=color:#66d9ef>struct</span> timeval t;
	uint16_t type;
	uint16_t code;
	int32_t value;
} input_event_t;

<span style=color:#66d9ef>static</span> input_event_t data[<span style=color:#ae81ff>512</span>];

<span style=color:#66d9ef>static</span> <span style=color:#66d9ef>char</span> lookup[<span style=color:#ae81ff>256</span>] <span style=color:#f92672>=</span> {
	[KEY_1] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;1&#39;</span>, [KEY_2] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;2&#39;</span>, [KEY_3] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;3&#39;</span>, [KEY_4] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;4&#39;</span>,
	[KEY_5] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;5&#39;</span>, [KEY_6] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;6&#39;</span>, [KEY_7] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;7&#39;</span>, [KEY_8] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;8&#39;</span>,
	[KEY_9] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;9&#39;</span>, [KEY_0] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;0&#39;</span>, [KEY_Q] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Q&#39;</span>, [KEY_W] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;W&#39;</span>,
	[KEY_E] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;E&#39;</span>, [KEY_R] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;R&#39;</span>, [KEY_T] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;T&#39;</span>, [KEY_Y] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Y&#39;</span>,
	[KEY_U] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;U&#39;</span>, [KEY_I] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;I&#39;</span>, [KEY_O] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;O&#39;</span>, [KEY_P] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;P&#39;</span>,
	[KEY_A] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;A&#39;</span>, [KEY_S] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;S&#39;</span>, [KEY_D] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;D&#39;</span>, [KEY_F] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;F&#39;</span>,
	[KEY_G] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;G&#39;</span>, [KEY_H] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;H&#39;</span>, [KEY_J] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;J&#39;</span>, [KEY_K] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;K&#39;</span>,
	[KEY_L] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;L&#39;</span>, [KEY_Z] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Z&#39;</span>, [KEY_X] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;X&#39;</span>, [KEY_C] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;C&#39;</span>,
	[KEY_V] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;V&#39;</span>, [KEY_B] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;B&#39;</span>, [KEY_N] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;N&#39;</span>, [KEY_M] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;M&#39;</span>,
	[KEY_SPACE] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39; &#39;</span>, [KEY_LEFTSHIFT] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;^&#39;</span>, [KEY_RIGHTSHIFT] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;^&#39;</span>
};

<span style=color:#66d9ef>int</span>
<span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>void</span>)
{
	FILE <span style=color:#f92672>*</span>f <span style=color:#f92672>=</span> fopen(<span style=color:#e6db74>&#34;./dump&#34;</span>, <span style=color:#e6db74>&#34;r&#34;</span>);

	fread(data, <span style=color:#66d9ef>sizeof</span>(input_event_t), <span style=color:#ae81ff>255</span>, f);

	<span style=color:#66d9ef>int</span> i;
	<span style=color:#66d9ef>for</span> (i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; i <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>255</span>; i<span style=color:#f92672>++</span>) {
		<span style=color:#66d9ef>if</span> (lookup[data[i].code] <span style=color:#f92672>&amp;&amp;</span> data[i].type <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&amp;&amp;</span> data[i].value <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>)
			printf(<span style=color:#e6db74>&#34;%c&#34;</span>, lookup[data[i].code]);
	}
	printf(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);

	fclose(f);

	<span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}

</code></pre></div></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>xil.se</span></p><p class=copyright-item><span>Link:</span>
<a href=https://blog.xil.se/posts/pwn2win-2016-dump-rspkt/>https://blog.xil.se/posts/pwn2win-2016-dump-rspkt/</span></p></div><div class=post-tags><section><a href=javascript:window.history.back();>back</a></span> Â·
<span><a href=https://blog.xil.se/>home</a></span></section></div><div class=post-nav><a href=https://blog.xil.se/posts/pwn2win-2016-painel-message-rspkt/ class=prev rel=prev title="Pwn2Win CTF 2016 Painel Message (Forensics 50) Writeup"><i class="iconfont icon-left"></i>&nbsp;Pwn2Win CTF 2016 Painel Message (Forensics 50) Writeup</a>
<a href=https://blog.xil.se/posts/pwn2win-2016-secret-accounts-rspkt/ class=next rel=next title="Pwn2Win CTF 2016 Secret Accounts (Py 80) Writeup">Pwn2Win CTF 2016 Secret Accounts (Py 80) Writeup&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-comment></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span class=with-love><i class="iconfont icon-love"></i></span><span class=author itemprop=copyrightHolder><a href=https://blog.xil.se/>xil.se</a> |</span>
<span>Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow">Hugo</a> & <a href=https://github.com/liuzc/leaveit target=_blank rel="external nofollow">LeaveIt</a></span></div></footer><script src=https://blog.xil.se/js/vendor_no_gallery.min.js async></script></div></body></html>