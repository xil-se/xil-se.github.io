<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta name=author content="xil.se"><link rel=prev href=https://blog.xil.se/posts/pwn2win-2016-sleeper-cell-kbeckmann/><link rel=next href=https://blog.xil.se/posts/pwn2win-2016-simple-crypto-rspkt/><link rel=canonical href=https://blog.xil.se/posts/pwn2win-2016-sequences-rspkt/><link rel=apple-touch-icon sizes=180x180 href=https://blog.xil.se/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://blog.xil.se/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://blog.xil.se/favicon-16x16.png><link rel=manifest href=https://blog.xil.se/site.webmanifest><link rel=mask-icon href=https://blog.xil.se/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><title>Pwn2Win CTF 2016 Sequences (PPC 40) Writeup | Blog</title><meta name=title content="Pwn2Win CTF 2016 Sequences (PPC 40) Writeup | Blog"><link rel=stylesheet href=https://blog.xil.se/font/iconfont.css><link rel=stylesheet href=https://blog.xil.se/css/main.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.xil.se\/"},"articleSection":"posts","name":"Pwn2Win CTF 2016 Sequences (PPC 40) Writeup","headline":"Pwn2Win CTF 2016 Sequences (PPC 40) Writeup","description":"Problem  Description: Warm up for the next PPC challenges. The Club guys love sequences, and it is always good to know your enemy.\n We will show you some sequences, and after each sequence you need to predict the values which correctly fill the asked positions. We ALWAYS adopt the convention that position 1 corresponds to the first number of the sequence.\nOutput sent by the server: Position - Sequence","inLanguage":"en-us","author":"rspkt","creator":"rspkt","publisher":"rspkt","accountablePerson":"rspkt","copyrightHolder":"rspkt","copyrightYear":"2016","datePublished":"2016-03-28 00:44:00 \u002b0100 \u002b0100","dateModified":"2016-03-28 00:44:00 \u002b0100 \u002b0100","url":"https:\/\/blog.xil.se\/posts\/pwn2win-2016-sequences-rspkt\/","wordCount":"507","keywords":["Blog"]}</script></head><body><div class=wrapper><nav class=navbar><div class=container><div class="navbar-header header-logo"><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href=https://blog.xil.se/>Blog</a></div><div class="menu navbar-right"><a class=menu-item href=https://blog.xil.se/posts/>Blog</a>
<a class=menu-item href=https://blog.xil.se/categories/>Categories</a></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><div class=container><div class=navbar-header><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href=https://blog.xil.se/>Blog</a></div><div class=menu-toggle><span></span><span></span><span></span></div></div><div class=menu id=mobile-menu><a class=menu-item href=https://blog.xil.se/posts/>Blog</a>
<a class=menu-item href=https://blog.xil.se/categories/>Categories</a></div></div></nav><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">Pwn2Win CTF 2016 Sequences (PPC 40) Writeup</h1><div class=post-meta>Written by <a itemprop=name href=https://blog.xil.se/author/rspkt rel=author>rspkt</a> with ♥
<span class=post-time>on <time datetime=2016-03-28 itemprop=datePublished>March 28, 2016</time></span>
in
<i class="iconfont icon-folder"></i><span class=post-category><a href=https://blog.xil.se/categories/writeups/>writeups</a></span></div></header><div class=post-content><h1 id=problem>Problem</h1><blockquote><p>Description: Warm up for the next PPC challenges. The Club guys love
sequences, and it is always good to know your enemy.</p></blockquote><p>We will show you some sequences, and after each sequence you need to predict
the values which correctly fill the asked positions. We ALWAYS adopt the
convention that position 1 corresponds to the first number of the sequence.</p><p>Output sent by the server: Position - Sequence</p><p>Result format expected by the server: result1,result2,result3,result4&mldr;</p><h1 id=solution>Solution</h1><p>This challenge was pretty straight forward. Detect what sequences that were
used, apply them to find the nth number of the sequence, get flag.</p><p>The server sent the first three numbers from each sequence. First thing we
wanted to figure out if it was an arithmetic sequence (add a value) or
geometric sequence (multiply with value).</p><p>If it&rsquo;s an arithmetic sequence, the third number should be obtained by
calculating the difference between the first and second number, and add that to
the second number. If it&rsquo;s a geometric sequence, the third number should be
obtained by calculating the ratio between the first and second number, and
multiply that to the second number.</p><p>This worked fine for most sequences, but from time to time we got floating
point numbers as ratios. The two numbers that were always recurring was phi
(the golden ratio), and the Tribonacci constant. These ratios occur between
numbers in the Fibonacci sequence and the Tribonacci sequence. We delt with
this by simply implementing the generalized versions of the Fibonacci and
Tribonacci sequences, and applying those whenever the constants popped up in
the ratio calculations.</p><p>Code</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> __future__ <span style=color:#f92672>import</span> division
<span style=color:#f92672>import</span> re

<span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>

<span style=color:#75715e># Phi and the Tribonacci constant</span>
PHI <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.618033988749</span>
TRIB <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.839286755214</span>


<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>gen_fib_n</span>(a, b, n):
    <span style=color:#66d9ef>if</span> n <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>2</span>:
        <span style=color:#66d9ef>return</span> n
    <span style=color:#66d9ef>for</span> num <span style=color:#f92672>in</span> xrange(<span style=color:#ae81ff>2</span>, n):
        a, b <span style=color:#f92672>=</span> b, b <span style=color:#f92672>+</span> a
    <span style=color:#66d9ef>return</span> b


<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>gen_trib_n</span>(a, b, c, n):
    <span style=color:#66d9ef>if</span> n <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>3</span>:
        <span style=color:#66d9ef>return</span> n
    <span style=color:#66d9ef>for</span> num <span style=color:#f92672>in</span> xrange(<span style=color:#ae81ff>2</span>, n):
        a, b, c <span style=color:#f92672>=</span> b, c, c <span style=color:#f92672>+</span> b <span style=color:#f92672>+</span> a
    <span style=color:#66d9ef>return</span> b


<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>calc_nth</span>(a, b, c, n):
    <span style=color:#75715e># Calculate the sequence params</span>
    params <span style=color:#f92672>=</span> {
        <span style=color:#e6db74>&#39;add&#39;</span>: b <span style=color:#f92672>-</span> a,
        <span style=color:#e6db74>&#39;mul&#39;</span>: b <span style=color:#f92672>/</span> a,
    }

    <span style=color:#75715e># IF fibonacci/tribonacci, treat specially</span>
    <span style=color:#66d9ef>if</span> abs(params[<span style=color:#e6db74>&#39;mul&#39;</span>] <span style=color:#f92672>-</span> PHI) <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0.1</span>:
        <span style=color:#66d9ef>return</span> gen_fib_n(a, b, n)
    <span style=color:#66d9ef>if</span> abs(params[<span style=color:#e6db74>&#39;mul&#39;</span>] <span style=color:#f92672>-</span> TRIB) <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0.1</span>:
        <span style=color:#66d9ef>return</span> gen_trib_n(a, b, c, n)

    <span style=color:#75715e># Sequence with params, calculate the diff</span>
    diffs <span style=color:#f92672>=</span> {
        <span style=color:#e6db74>&#39;add&#39;</span>: c <span style=color:#f92672>-</span> (b <span style=color:#f92672>+</span> params[<span style=color:#e6db74>&#39;add&#39;</span>]),
        <span style=color:#e6db74>&#39;mul&#39;</span>: c <span style=color:#f92672>-</span> (b <span style=color:#f92672>*</span> params[<span style=color:#e6db74>&#39;mul&#39;</span>]),
    }

    <span style=color:#75715e># Find the type with the smallest diff</span>
    t <span style=color:#f92672>=</span> min(diffs<span style=color:#f92672>.</span>iteritems(), key<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> (x, y): abs(y))[<span style=color:#ae81ff>0</span>]

    <span style=color:#75715e># Now we know the type. Let&#39;s calculate the nth term.</span>
    <span style=color:#66d9ef>if</span> t <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;add&#39;</span>:
        <span style=color:#66d9ef>return</span> int(a <span style=color:#f92672>+</span> (n <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> params[<span style=color:#e6db74>&#39;add&#39;</span>])
    <span style=color:#66d9ef>elif</span> t <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;mul&#39;</span>:
        <span style=color:#66d9ef>return</span> int((a <span style=color:#f92672>*</span> (params[<span style=color:#e6db74>&#39;mul&#39;</span>]<span style=color:#f92672>**</span>(n <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)))<span style=color:#f92672>.</span>round())


<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>doit</span>():
    p <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#39;pool.pwn2win.party&#39;</span>, <span style=color:#ae81ff>1337</span>)

    res <span style=color:#f92672>=</span> []
    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>15</span>):
        line <span style=color:#f92672>=</span> p<span style=color:#f92672>.</span>readline()<span style=color:#f92672>.</span>rstrip()
        (n, a, b, c) <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>match(<span style=color:#e6db74>&#39;(\d+) - (\d+) -&gt; (\d+) -&gt; (\d+)&#39;</span>, line)<span style=color:#f92672>.</span>groups()
        nth <span style=color:#f92672>=</span> calc_nth(int(a), int(b), int(c), int(n))
        res<span style=color:#f92672>.</span>append(nth)

    answer <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;,&#39;</span><span style=color:#f92672>.</span>join(map(str, res))
    p<span style=color:#f92672>.</span>sendline(answer)

    <span style=color:#66d9ef>print</span> p<span style=color:#f92672>.</span>readall()


<span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
    doit()

</code></pre></div></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>xil.se</span></p><p class=copyright-item><span>Link:</span>
<a href=https://blog.xil.se/posts/pwn2win-2016-sequences-rspkt/>https://blog.xil.se/posts/pwn2win-2016-sequences-rspkt/</span></p></div><div class=post-tags><section><a href=javascript:window.history.back();>back</a></span> ·
<span><a href=https://blog.xil.se/>home</a></span></section></div><div class=post-nav><a href=https://blog.xil.se/posts/pwn2win-2016-sleeper-cell-kbeckmann/ class=prev rel=prev title="Pwn2Win 2016 Sleeper Cell (Reverse) Writeup"><i class="iconfont icon-left"></i>&nbsp;Pwn2Win 2016 Sleeper Cell (Reverse) Writeup</a>
<a href=https://blog.xil.se/posts/pwn2win-2016-simple-crypto-rspkt/ class=next rel=next title="Pwn2Win CTF 2016 Simple Cryptography (Crypto 60) Writeup">Pwn2Win CTF 2016 Simple Cryptography (Crypto 60) Writeup&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-comment></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span class=with-love><i class="iconfont icon-love"></i></span><span class=author itemprop=copyrightHolder><a href=https://blog.xil.se/>xil.se</a> |</span>
<span>Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow">Hugo</a> & <a href=https://github.com/liuzc/leaveit target=_blank rel="external nofollow">LeaveIt</a></span></div></footer><script src=https://blog.xil.se/js/vendor_no_gallery.min.js async></script></div></body></html>