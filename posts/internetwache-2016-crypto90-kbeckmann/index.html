<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta name=author content="xil.se"><link rel=prev href=https://blog.xil.se/posts/internetwache-2016-crypto70-kbeckmann/><link rel=next href=https://blog.xil.se/posts/internetwache-2016-exp50-kbeckmann/><link rel=canonical href=https://blog.xil.se/posts/internetwache-2016-crypto90-kbeckmann/><link rel=apple-touch-icon sizes=180x180 href=https://blog.xil.se/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://blog.xil.se/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://blog.xil.se/favicon-16x16.png><link rel=manifest href=https://blog.xil.se/site.webmanifest><link rel=mask-icon href=https://blog.xil.se/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><title>InternetWache 2016 Bank (Crypto 90) Writeup | Blog</title><meta name=title content="InternetWache 2016 Bank (Crypto 90) Writeup | Blog"><link rel=stylesheet href=https://blog.xil.se/font/iconfont.css><link rel=stylesheet href=https://blog.xil.se/css/main.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.xil.se\/"},"articleSection":"posts","name":"InternetWache 2016 Bank (Crypto 90) Writeup","headline":"InternetWache 2016 Bank (Crypto 90) Writeup","description":"Problem  Description: Everyone knows that banks are insecure. This one super secure and only allows only 20 transactions per session. I always wanted a million on my account.\n (crypto90, solved by 104)\nAttachment: crypto90.zip\nService: 188.166.133.53:10061\nSolution The challenge file contains a python script that is also running on the challenge server.\nRunning it shows us an interface to do transactions.\nWe can put money into our account by creating a transaction and then signing it using a signature that we get from the server.","inLanguage":"en-us","author":"kbeckmann","creator":"kbeckmann","publisher":"kbeckmann","accountablePerson":"kbeckmann","copyrightHolder":"kbeckmann","copyrightYear":"2016","datePublished":"2016-02-20 23:44:08 \u002b0100 \u002b0100","dateModified":"2016-02-20 23:44:08 \u002b0100 \u002b0100","url":"https:\/\/blog.xil.se\/posts\/internetwache-2016-crypto90-kbeckmann\/","wordCount":"346","keywords":["Blog"]}</script></head><body><div class=wrapper><nav class=navbar><div class=container><div class="navbar-header header-logo"><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href=https://blog.xil.se/>Blog</a></div><div class="menu navbar-right"><a class=menu-item href=https://blog.xil.se/posts/>Blog</a>
<a class=menu-item href=https://blog.xil.se/categories/>Categories</a></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><div class=container><div class=navbar-header><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href=https://blog.xil.se/>Blog</a></div><div class=menu-toggle><span></span><span></span><span></span></div></div><div class=menu id=mobile-menu><a class=menu-item href=https://blog.xil.se/posts/>Blog</a>
<a class=menu-item href=https://blog.xil.se/categories/>Categories</a></div></div></nav><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">InternetWache 2016 Bank (Crypto 90) Writeup</h1><div class=post-meta>Written by <a itemprop=name href=https://blog.xil.se/author/kbeckmann rel=author>kbeckmann</a> with ♥
<span class=post-time>on <time datetime=2016-02-20 itemprop=datePublished>February 20, 2016</time></span>
in
<i class="iconfont icon-folder"></i><span class=post-category><a href=https://blog.xil.se/categories/writeups/>writeups</a></span></div></header><div class=post-content><h1 id=problem>Problem</h1><blockquote><p>Description: Everyone knows that banks are insecure. This one super secure and only allows only 20 transactions per session. I always wanted a million on my account.</p></blockquote><p>(crypto90, solved by 104)</p><p>Attachment: crypto90.zip</p><p>Service: 188.166.133.53:10061</p><h1 id=solution>Solution</h1><p>The challenge file contains a python script that is also running on the challenge server.</p><p>Running it shows us an interface to do transactions.</p><p>We can put money into our account by creating a transaction and then signing it using a signature that we get from the server. The flag will be shown to us if our balance reaches 1000000. The problem is that we can only put 5000 units into our account, and are limited to 20 transactions.</p><p>The solution is to create a crafted signature.</p><p>Looking at the source we find that the signature contains simply a constant string and the value we want to put into our account. It is encrypted with a simple xor crypto but with an unknown key.</p><p>Since we know the plaintext prefix <code>TRANSACTION:</code> we can do a fast known plaintext attack. Using the key, we can craft a new ciphertext but with a diferent message. I changed the transaction value to 50000 units, but in hindsight i should have used 99999.</p><p>I added this in the Cipher class:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>crack</span>(self, ct):
  <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;cracking&#39;</span>, ct<span style=color:#f92672>.</span>encode(<span style=color:#e6db74>&#39;hex&#39;</span>))
  i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
  <span style=color:#66d9ef>while</span> i <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>2</span><span style=color:#f92672>**</span><span style=color:#ae81ff>32</span>:
    self<span style=color:#f92672>.</span>__r<span style=color:#f92672>.</span>set_x(i)
    pt <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
    <span style=color:#66d9ef>for</span> c <span style=color:#f92672>in</span> ct:
      pt <span style=color:#f92672>+=</span> chr(ord(c) <span style=color:#f92672>^</span> (self<span style=color:#f92672>.</span>__r<span style=color:#f92672>.</span>get_next() <span style=color:#f92672>%</span> <span style=color:#ae81ff>2</span><span style=color:#f92672>**</span><span style=color:#ae81ff>7</span>))
    <span style=color:#66d9ef>if</span> pt<span style=color:#f92672>.</span>startswith(<span style=color:#e6db74>&#34;TRANSACTION&#34;</span>):
      <span style=color:#66d9ef>print</span> <span style=color:#e6db74>&#39;plaintext: &#39;</span>, pt, i
      <span style=color:#66d9ef>break</span>
    i <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
  <span style=color:#66d9ef>print</span> <span style=color:#e6db74>&#34;FOUND IT &#34;</span>, str(i)
  self<span style=color:#f92672>.</span>__r<span style=color:#f92672>.</span>set_x(i)
  pt <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;TRANSACTION:50000&#34;</span>
  ct <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
  <span style=color:#66d9ef>for</span> c <span style=color:#f92672>in</span> pt:
    ct <span style=color:#f92672>+=</span> chr( ord(c) <span style=color:#f92672>^</span> (self<span style=color:#f92672>.</span>__r<span style=color:#f92672>.</span>get_next() <span style=color:#f92672>%</span> <span style=color:#ae81ff>2</span><span style=color:#f92672>**</span><span style=color:#ae81ff>7</span>) )
  <span style=color:#66d9ef>print</span> (<span style=color:#e6db74>&#39;ENCRYPTED&#39;</span>, ct<span style=color:#f92672>.</span>encode(<span style=color:#e6db74>&#39;hex&#39;</span>))
  <span style=color:#66d9ef>return</span> i

<span style=color:#f92672>...</span>
<span style=color:#75715e># added this to the command parser</span>
<span style=color:#66d9ef>elif</span>(<span style=color:#e6db74>&#34;crack&#34;</span> <span style=color:#f92672>in</span> cmd):
  a <span style=color:#f92672>=</span> cmd<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#34;crack &#34;</span>,<span style=color:#e6db74>&#34;&#34;</span>)
  ct <span style=color:#f92672>=</span> a<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#39;hex&#39;</span>)
  <span style=color:#66d9ef>print</span> <span style=color:#e6db74>&#34;crack!&#34;</span>, a
  key <span style=color:#f92672>=</span> C<span style=color:#f92672>.</span>crack(ct)
  t, i <span style=color:#f92672>=</span> A<span style=color:#f92672>.</span>create_t(<span style=color:#ae81ff>50000</span>)
  t<span style=color:#f92672>.</span>set_k(i)
  ct <span style=color:#f92672>=</span> C<span style=color:#f92672>.</span>encrypt(t)

</code></pre></div><p>I then manually ran my cracker <em>sigh</em> and crafted signatures 20 times. It worked and I got the flag.</p><p>I lost the flag for the writeup and will not run the script again&mldr;</p></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>xil.se</span></p><p class=copyright-item><span>Link:</span>
<a href=https://blog.xil.se/posts/internetwache-2016-crypto90-kbeckmann/>https://blog.xil.se/posts/internetwache-2016-crypto90-kbeckmann/</span></p></div><div class=post-tags><section><a href=javascript:window.history.back();>back</a></span> ·
<span><a href=https://blog.xil.se/>home</a></span></section></div><div class=post-nav><a href=https://blog.xil.se/posts/internetwache-2016-crypto70-kbeckmann/ class=prev rel=prev title="InternetWache 2016 A numbers game II (Crypto 70) Writeup"><i class="iconfont icon-left"></i>&nbsp;InternetWache 2016 A numbers game II (Crypto 70) Writeup</a>
<a href=https://blog.xil.se/posts/internetwache-2016-exp50-kbeckmann/ class=next rel=next title="InternetWache 2016 Ruby's count (Exploit 50) Writeup">InternetWache 2016 Ruby's count (Exploit 50) Writeup&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-comment></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span class=with-love><i class="iconfont icon-love"></i></span><span class=author itemprop=copyrightHolder><a href=https://blog.xil.se/>xil.se</a> |</span>
<span>Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow">Hugo</a> & <a href=https://github.com/liuzc/leaveit target=_blank rel="external nofollow">LeaveIt</a></span></div></footer><script src=https://blog.xil.se/js/vendor_no_gallery.min.js async></script></div></body></html>